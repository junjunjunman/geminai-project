<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê³µê³µë¬¸ì„œ ìš”ì•½ ë° í–‰ë™ ì•ˆë‚´ AI</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <div class="hero">
        <div class="container">
            <h1>ğŸ“„ ê³µê³µë¬¸ì„œ ìš”ì•½ ë° í–‰ë™ ì•ˆë‚´ AI</h1>
            <p class="description">
                ë³µì¡í•œ ê³µê³µë¬¸ì„œë¥¼ ì‰½ê²Œ ìš”ì•½í•˜ê³ , ì§€ê¸ˆ ë‚´ê°€ í•´ì•¼ í•  í–‰ë™ê¹Œì§€ ì•ˆë‚´í•´ë“œë¦½ë‹ˆë‹¤.
            </p>

            <div id="drop_area">
                <input type="file" id="pdf_file" accept=".pdf">
            </div>

            <button id="start_btn">ìš”ì•½ ì‹œì‘</button>

            <div class="loader" id="loader"></div>

            <h2>ìš”ì•½ ê²°ê³¼</h2>
            <div id="summary_result" class="result_card">
                <span class="placeholder">ì—¬ê¸°ì— ìš”ì•½ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.</span>
            </div>
        </div>
    </div>

    <script>
        const dropArea = document.getElementById('drop_area');
        const fileInput = document.getElementById('pdf_file');
        const startBtn = document.getElementById('start_btn');
        const resultDiv = document.getElementById('summary_result');
        const loader = document.getElementById('loader');

        let uploadedFile = null;

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­
        dropArea.addEventListener('dragover', e => {
            e.preventDefault();
            dropArea.classList.add('dragover');
        });

        dropArea.addEventListener('dragleave', e => {
            e.preventDefault();
            dropArea.classList.remove('dragover');
        });

        dropArea.addEventListener('drop', e => {
            e.preventDefault();
            dropArea.classList.remove('dragover');
            if (e.dataTransfer.files.length > 0) {
                uploadedFile = e.dataTransfer.files[0];
                fileInput.files = e.dataTransfer.files;
            }
        });

        fileInput.addEventListener('change', () => {
            if (fileInput.files.length > 0) {
                uploadedFile = fileInput.files[0];
            }
        });

        startBtn.addEventListener('click', () => {
            if (!uploadedFile) {
                alert('PDF íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            // ë¡œë”© í‘œì‹œ ë° ì´ì „ ê²°ê³¼ ì´ˆê¸°í™”
            resultDiv.innerHTML = '';
            loader.style.display = 'block';

            const formData = new FormData();
            formData.append('pdf_file', uploadedFile);

            fetch('/summarize', { method: 'POST', body: formData })
                .then(res => res.json())
                .then(data => {
                    loader.style.display = 'none';
                    resultDiv.innerHTML = ''; // ì´ˆê¸°í™”

                    if (data.error) {
                        resultDiv.innerHTML = `<span class="placeholder">ì˜¤ë¥˜ ë°œìƒ: ${data.error}</span>`;
                    } else {
                        // ìš”ì•½ í…ìŠ¤íŠ¸ ê°•ì¡°
                        const lines = data.summary.split('\n').map(line => {
                            if (line.includes('í•´ì•¼ í•©ë‹ˆë‹¤') || line.includes('ê¸°í•œ')) {
                                return `<strong>${line}</strong>`;
                            }
                            return line;
                        }).join('<br>');

                        resultDiv.innerHTML = lines;
                    }
                })
                .catch(err => {
                    loader.style.display = 'none';
                    resultDiv.innerHTML = `<span class="placeholder">ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${err}</span>`;
                });
        });
    </script>
</body>
</html>
